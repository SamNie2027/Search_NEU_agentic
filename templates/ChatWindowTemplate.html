<!DOCTYPE html>
<html>
<head>
    <title>Course Search Chatbot</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div id="chat-messages">
        <!-- Messages will be added here dynamically -->
    </div>

    <!-- Input area -->
    <div class="input-container">
      <input type="text" class="message-input" placeholder="Type a message...">
      <button class="send-button">Send</button>
    </div>
    <script>
        // Get elements
        const chatContainer = document.querySelector('.chat-container'); // or wherever messages should appear
        const messageInput = document.querySelector('.message-input');
        const sendButton = document.querySelector('.send-button');

        // Function to add a message to the chat
        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = isUser ? 'message user-message' : 'message bot-message';
    
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
    
            if (isUser) {
                contentDiv.textContent = content;
            } else {
                contentDiv.innerHTML = content;
            }
    
            messageDiv.appendChild(contentDiv);
    
            // Insert before the input container
            const inputContainer = document.querySelector('.input-container');
            inputContainer.parentNode.insertBefore(messageDiv, inputContainer);
    
            // Scroll to bottom
            window.scrollTo(0, document.body.scrollHeight);
        }

        // Function to send message
        async function sendMessage() {
            const message = messageInput.value.trim();
    
            if (!message) return;
    
            // Add user message to chat
            addMessage(message, true);
    
            // Clear input and disable button
            messageInput.value = '';
            sendButton.disabled = true;
            sendButton.textContent = 'Sending...';
    
            try {
                // Send request to backend
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `message=${encodeURIComponent(message)}`
                });
        
                const data = await response.json();
        
                // Add bot response to chat
                addMessage(data.response, false);
        
            } catch (error) {
                console.error('Error:', error);
                addMessage('<p>Sorry, there was an error processing your request.</p>', false);
            } finally {
                // Re-enable button
                sendButton.disabled = false;
                sendButton.textContent = 'Send';
                messageInput.focus();
            }
        }

        // Event listeners
        sendButton.addEventListener('click', sendMessage);

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Focus input on load
        messageInput.focus();
    </script>
</body>
</html>